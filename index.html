<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>H·ªôp m√π b√≠ ·∫©n c·ªßa l·ªõp 9/10üòã </title>
<style>
  :root{
    --bg1:#05060b; --bg2:#0b0f1c; --bg3:#111325;
    --accent:#ff83c5; --accent2:#ffb2e3; --accent3:#ffd5f0;
    --glow:#ff8bd1; --text:#ffffff;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:
      radial-gradient(1200px 800px at 70% 10%, rgba(160,60,160,.08), transparent 40%),
      radial-gradient(900px 700px at 20% 80%, rgba(60,120,255,.06), transparent 40%),
      linear-gradient(180deg, var(--bg1), var(--bg2) 60%, var(--bg3));
    overflow:hidden;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  }

  .noise{
    position:fixed; inset:-50%; pointer-events:none; opacity:.06; mix-blend-mode:screen;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.7"/></svg>');
    animation: drift 16s linear infinite;
  }
  @keyframes drift{from{transform:translate3d(0,0,0)} to{transform:translate3d(50px,0,0)}}

  #bgvid{
    position:fixed; inset:0; width:100%; height:100%;
    object-fit:cover; filter:brightness(.25) blur(2px) saturate(1.15);
    opacity:0; transition:opacity .6s ease;
  }
  body.showVideo #bgvid{opacity:.95}

  #fx{position:fixed; inset:0; width:100%; height:100%; display:block; touch-action:none}

  .center{position:fixed; inset:0; display:grid; place-items:center; pointer-events:none}
  .copy{ text-align:center; padding:2rem 1rem; }
  .headline{
    --shine1:#fff; --shine2:#ffe7f6; --shine3:#ffd2f0; --shadow: rgba(255,139,209,.35);
    font-weight:900; letter-spacing:.6px; line-height:1.15; color:transparent;
    font-size:clamp(24px, 5.2vw, 64px);
    background:linear-gradient(90deg, var(--shine1), var(--shine2), var(--shine3), var(--shine1));
    background-size:300% 100%; -webkit-background-clip:text; background-clip:text;
    filter: drop-shadow(0 8px 30px var(--shadow));
    opacity:0; transform:translateY(10px) scale(.98);
    animation: headlineIn 1.2s ease forwards .2s, sheen 8s ease-in-out infinite 1.4s;
  }
  @keyframes sheen{0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%}}
  @keyframes headlineIn{to{opacity:1; transform:translateY(0) scale(1)}}

  .headline .char{
    display:inline-block; opacity:0;
    transform: translateY(12px) rotate(0.5deg) scale(.96);
    filter: blur(4px);
  }
  .headline .char.show{ animation: charPop .9s cubic-bezier(.2,.7,.2,1) forwards; }
  @keyframes charPop{
    0%{opacity:0; transform:translateY(18px) scale(.9); filter:blur(8px)}
    60%{opacity:1; transform:translateY(-4px) scale(1.04); filter:blur(0)}
    100%{opacity:1; transform:translateY(0) scale(1)}
  }
  /* D√≤ng ch·ªØ d∆∞·ªõi tr√°i tim */
  #belowHeart{
    min-height:2.4em;
    color:#ffe9fb;
    font-size:clamp(16px, 2.1vw, 22px);
    font-weight:500;
    letter-spacing:.03em;
    text-align:center;
    text-shadow:0 0 10px rgba(255,140,220,.85);
    opacity:0;
    transform:translateY(8px);
    transition:opacity .6s ease, transform .6s ease;
    pointer-events:none;
  }

  #belowHeart.show{
    opacity:1;
    transform:translateY(0);
  }

  /* Ch·ªØ r∆°i nh·ªè */
  .fallingText {
    position: fixed;
    top: -40px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 14px;               /* nh·ªè h∆°n */
    font-weight: 700;
    pointer-events: none;
    white-space: nowrap;
    color: transparent;

    --base-grad: linear-gradient(90deg, #ffd5f0, #ffb2e3, #ff83c5, #ffd5f0);
    --shine-grad: linear-gradient(120deg, transparent 16%, rgba(255,255,255,.9) 46%, rgba(255,200,240,.6) 54%, transparent 84%);
    background-image: var(--shine-grad), var(--base-grad);
    background-size: 200% 100%, 300% 100%;
    background-clip: text;
    -webkit-background-clip: text;

    animation: fall linear forwards, shineSweep 3.6s linear infinite;
  }

  /* Mobile: ch·ªØ c√†ng nh·ªè n·ªØa cho ch·∫Øc */
  @media (max-width: 600px){
    .fallingText{
      font-size: 11px;
    }
  }


  @keyframes fall {
    0%   { transform: translateY(-60px) translateX(calc(-50% + var(--x))); opacity: 0; }
    10%  { opacity: 1; }
    100% { transform: translateY(120vh) translateX(calc(-50% + var(--x))); opacity: 0; }
  }


  @keyframes shineSweep {
    0% { background-position: -200% 0, 0 50% }
    100% { background-position: 200% 0, 0 50% }
  }

  /* ========== LOTUS BLOOM INTRO CSS ========== */
  #lotusIntro{
    position:fixed; inset:0; z-index:999999;
    pointer-events:none;
    background:
      radial-gradient(160vmax 90vmax at 50% 45%, rgba(255,200,245,.06), transparent 42%),
      radial-gradient(circle at 50% 55%, #0a0212 0%, #05000a 55%, #000 100%);
  }
  .lotusWrap{ position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:70vmin; height:70vmin; }

  .petal{
    position:absolute; left:50%; top:50%;
    width:14vmin; height:26vmin;
    transform-origin:50% 88%;
    transform:translate(-50%,-88%) rotate(var(--rot)) scale(.12);
    opacity:0;
    clip-path: ellipse(50% 65% at 50% 35%);
    background: radial-gradient(50% 65% at 50% 35%,
                rgba(255,255,255,.95) 0%,
                #ffd2f2 28%, #ff9edd 56%, rgba(255,158,221,0) 70%);
    filter: drop-shadow(0 0 18px rgba(255,140,220,.55));
    animation:
      petalIn 1.6s cubic-bezier(.2,.8,.2,1) forwards var(--delay),
      petalBreathe 3.6s ease-in-out infinite calc(var(--delay) + 1.7s);
  }
  @keyframes petalIn{
    0%{ opacity:0; transform:translate(-50%,-88%) rotate(var(--rot)) scale(.05); filter:blur(10px) }
    60%{ opacity:1 }
    100%{ opacity:1; transform:translate(-50%,-88%) rotate(var(--rot)) scale(1) }
  }
  @keyframes petalBreathe{
    0%,100%{ filter: drop-shadow(0 0 14px rgba(255,140,220,.5)) }
    50%{ filter: drop-shadow(0 0 28px rgba(255,170,240,.9)) }
  }

  #lotusCore{
    position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
    width:20vmin; height:20vmin; border-radius:50%;
    background: radial-gradient(circle at 50% 45%, #fff 0%, #ffe5f7 35%, rgba(255,210,245,.12) 62%, rgba(255,210,245,0) 70%);
    box-shadow:0 0 60px rgba(255,160,240,.6), 0 0 120px rgba(170,0,170,.25);
    animation: corePulse 2.4s ease-in-out infinite 1s;
  }
  @keyframes corePulse{
    0%,100%{ transform:translate(-50%,-50%) scale(1) }
    50%{ transform:translate(-50%,-50%) scale(1.08) }
  }

  .ripple{
    position:absolute; left:50%; top:50%;
    width:24vmin; height:24vmin; transform:translate(-50%,-50%);
    border:2px solid rgba(255,180,240,.55); border-radius:50%; opacity:0;
    animation:ripple 3.6s ease-out infinite;
  }
  .ripple.r2{ animation-delay:.9s } .ripple.r3{ animation-delay:1.8s }

  @keyframes ripple{
    0%{ opacity:.9; transform:translate(-50%,-50%) scale(.2) }
    80%{ opacity:.15 }
    100%{ opacity:0; transform:translate(-50%,-50%) scale(2.8) }
  }

  .spark{
    position:absolute; left:50%; top:50%;
    width:6px; height:6px; border-radius:50%;
    background: radial-gradient(circle,#fff 0%, #ffd5f5 60%, rgba(255,200,245,0) 75%);
    filter: drop-shadow(0 0 16px rgba(255,180,245,.9));
    opacity:0; transform:translate(-50%,-50%) scale(.8);
    animation: sparkOut 1.1s cubic-bezier(.2,.7,.2,1) forwards var(--d);
  }
  @keyframes sparkOut{
    10%{ opacity:1 }
    100%{ opacity:0; transform:translate(calc(-50% + var(--tx)), calc(-50% + var(--ty))) scale(.2) }
  }

  /* Curtain m·ªü chuy·ªÉn sang main scene */
  #lotusCurtain{
    position:absolute; left:50%; top:50%;
    width:24vmin; height:24vmin; border-radius:50%;
    transform:translate(-50%,-50%) scale(.2);
    background: radial-gradient(circle,
      rgba(255,255,255,1) 0%,
      rgba(255,245,255,0.98) 25%,
      rgba(255,210,245,0.8) 50%,
      rgba(255,180,240,0.0) 75%);
    box-shadow:
      0 0 90px rgba(255,255,255,0.9),
      0 0 180px rgba(255,180,240,0.85);
    filter:blur(6px);
    opacity:0;
    mix-blend-mode:screen;
  }

  #lotusCurtain.go{ animation: curtainOpen 1.1s ease-out forwards }

  @keyframes curtainOpen{
    0%{
      opacity:0;
      transform:translate(-50%,-50%) scale(.25);
    }
    25%{
      opacity:1;
      transform:translate(-50%,-50%) scale(1.4);
    }
    55%{
      opacity:1;
      transform:translate(-50%,-50%) scale(3.6);
    }
    100%{
      opacity:0;
      transform:translate(-50%,-50%) scale(10);
    }
  }


  @media (max-width:480px){
    #lotusCore{ width:26vmin; height:26vmin }
    .petal{ width:16vmin; height:30vmin }
  }
  /* V√î HI·ªÜU H√ìA ·∫©n intro khi reduce-motion b·∫≠t */
  @media (prefers-reduced-motion:reduce){
      #lotusIntro{ display:block !important }
  }
  /* Fade-out m∆∞·ª£t cho to√†n b·ªô intro */
  #lotusIntro.fade-out{
    animation: lotusFadeOut .9s ease-out forwards;
  }

  @keyframes lotusFadeOut{
    0%  { opacity:1; }
    100%{ opacity:0; }
  }
  /* N√¢ng c·∫•p intro: fade-in + glow + text */
  #lotusIntro{
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    opacity:0;
    transform:scale(1.04);
    animation: lotusIntroIn 1s ease-out forwards;
  }

  @keyframes lotusIntroIn{
    0%{
      opacity:0;
      transform:scale(1.06);
      filter:blur(4px);
    }
    100%{
      opacity:1;
      transform:scale(1);
      filter:blur(0);
    }
  }

  /* H√†o quang m·ªù ph√≠a sau hoa */
  .lotusGlow{
    position:absolute;
    left:50%; top:50%;
    width:40vmin; height:40vmin;
    transform:translate(-50%,-50%);
    border-radius:50%;
    background:
      radial-gradient(circle at 50% 35%,
        rgba(255,255,255,.9) 0%,
        rgba(255,230,250,.7) 28%,
        rgba(255,140,230,0.0) 70%);
    filter:blur(18px);
    opacity:.85;
    pointer-events:none;
    animation: lotusGlowPulse 3.2s ease-in-out infinite .2s;
  }

  @keyframes lotusGlowPulse{
    0%,100%{
      transform:translate(-50%,-50%) scale(1);
      opacity:.8;
    }
    50%{
      transform:translate(-50%,-50%) scale(1.08);
      opacity:1;
    }
  }

  /* Text intro b√™n d∆∞·ªõi hoa */
  .introTextWrap{
    margin-top:clamp(16px, 2.3vmin, 24px);
    text-align:center;
    color:#ffe9fb;
    text-shadow:0 0 12px rgba(255,140,230,.8);
    opacity:0;
    transform:translateY(10px);
    pointer-events:none;
    animation:introTextIn 1s ease-out forwards 1.1s;
  }

  .introTitle{
    font-weight:800;
    letter-spacing:.12em;
    text-transform:uppercase;
    font-size:clamp(12px, 1.9vmin, 14px);
    opacity:.95;
  }

  .introSubtitle{
    margin-top:6px;
    font-size:clamp(14px, 2.2vmin, 18px);
    font-weight:500;
  }

  @keyframes introTextIn{
    0%{
      opacity:0;
      transform:translateY(16px);
      filter:blur(4px);
    }
    100%{
      opacity:1;
      transform:translateY(0);
      filter:blur(0);
    }
  }
  /* Aura xoay c·ª±c nh·∫π */
  .lotusAura {
    position:absolute;
    left:50%; top:50%;
    width:48vmin; height:48vmin;
    transform:translate(-50%, -50%);
    border-radius:50%;
    background:conic-gradient(
        from 0deg,
        rgba(255,180,240,.35),
        rgba(255,140,220,.15),
        rgba(255,200,245,.28),
        rgba(255,160,240,.4)
    );
    animation: auraSpin 16s linear infinite;
    filter: blur(36px);
    opacity:.45;
    pointer-events:none;
  }
  @keyframes auraSpin {
    from { transform: translate(-50%,-50%) rotate(0deg); }
    to   { transform: translate(-50%,-50%) rotate(360deg); }
  }
  .particle {
    position:absolute;
    width:6px; height:6px;
    background: radial-gradient(circle, #fff, rgba(255,180,240,.4));
    border-radius:50%;
    opacity:.4;
    animation: floatUp 8s ease-in-out infinite;
    filter: blur(2px);
  }
  @keyframes floatUp {
    0%   { transform: translateY(0) translateX(0); opacity: .0; }
    20%  { opacity:.4; }
    60%  { opacity:.4; }
    100% { transform: translateY(-40px) translateX(16px); opacity:0; }
  }
  .introTitle {
    font-weight:800;
    text-transform:uppercase;
    letter-spacing:.22em;
    font-size:clamp(16px,2.6vmin,28px);
    opacity:0;
    transform:translateY(12px) scale(1.06);
    filter:blur(4px);
    animation:introCinema 1.2s ease-out forwards 1.2s;
  }

  .introSubtitle {
    margin-top:10px;
    font-size:clamp(14px,2.2vmin,20px);
    opacity:0;
    transform:translateY(16px) scale(1.04);
    filter:blur(4px);
    animation:introCinema 1.4s ease-out forwards 1.5s;
  }

  @keyframes introCinema {
    0% {
      opacity:0;
      transform:translateY(20px) scale(1.08);
      filter:blur(10px);
    }
    60% {
      opacity:1;
      transform:translateY(0) scale(1);
      filter:blur(0);
    }
    100% {
      opacity:1;
    }
  }
  #lotusIntro.fade-out{
    animation: lotusFadeOut .9s ease-out forwards,
              lotusBlurOut .9s ease-out forwards;
  }
  @keyframes lotusBlurOut {
    from { filter: blur(0px);}
    to   { filter: blur(18px);}
  }
  /* ================================
    MOBILE: Thu nh·ªè to√†n b·ªô giao di·ªán
    ƒë·ªÉ gi·ªëng PC, gi·ªØ nguy√™n t·ªâ l·ªá
  ================================ */
  @media (max-width: 768px) {
    body {
      transform: scale(0.82);
      transform-origin: top center;
      width: 122%;
      height: 122%;
    }

    #fx, #bgvid, .center, #rainContainer {
      transform: scale(1.0); /* gi·ªØ canvas ƒë√∫ng v·ªã tr√≠ */
    }
  }

</style>
</head>

<body>

  <!-- INTRO HOA SEN -->
  <div id="lotusIntro">
    <!-- H√†o quang n·ªÅn -->
    <div class="lotusAura"></div>

    <div class="lotusGlow"></div>

    <!-- C·ª•m hoa sen (c√°nh + nh√¢n + g·ª£n s√≥ng) -->
    <div class="lotusWrap" id="lotusWrap"></div>
    <div id="lotusCore"></div>
    <div class="ripple r1"></div>
    <div class="ripple r2"></div>
    <div class="ripple r3"></div>



    <!-- R√àM M·ªû CHUY·ªÇN C·∫¢NH -->
    <div id="lotusCurtain"></div>
  </div>


<!-- ch·ªØ r∆°i -->
<div id="rainContainer"></div>

<video id="bgvid" muted loop playsinline></video>
<canvas id="fx"></canvas>
<div class="noise" aria-hidden="true"></div>

<div class="center">
  <div class="copy">
    <h1 class="headline" id="headline">T·∫≠p th·ªÉ l·ªõp 9/10 ch√∫c c√¥ 20/11 vui v·∫ª</h1>
  </div>
</div>

<!-- D√≤ng ch·ªØ d∆∞·ªõi tr√°i tim -->
<div id="belowHeart"></div>
<script>
(() => {

  /* ==========================
     H√ÄM B·∫ÆT ƒê·∫¶U MAIN SCENE
     (TR√ÅI TIM + CH·ªÆ + CH·ªÆ R∆†I)
  ========================== */
  function startMainScene(){
    // setup canvas l·∫ßn ƒë·∫ßu
    resize();
    // b·∫≠t animation cho headline
    initHeadline();
    // ch·∫°y render loop
    requestAnimationFrame(render);
    // b·∫Øt ƒë·∫ßu ch·ªØ r∆°i
    spawnFallingText();
    // kh·ªüi t·∫°o orbiters ch·∫°y quanh tim
    initOrbiters();
    // b·∫Øt ƒë·∫ßu ƒë·ªïi c√¢u ch√∫c d∆∞·ªõi tr√°i tim
    cycleBelowText();
    // n·ªï 1 c√∫ burst ·ªü gi·ªØa sau 1 ch√∫t
    setTimeout(()=> spawnBurst(window.innerWidth/2, window.innerHeight/2, 200, 1.4), 1200);
  }


  function createLotusIntro() {
    const intro   = document.getElementById("lotusIntro");
    const wrap    = document.getElementById("lotusWrap");
    const curtain = document.getElementById("lotusCurtain");

    /* ---- particles nh·∫π nh√†ng ---- */
    for (let i = 0; i < 10; i++){
      const pr = document.createElement("div");
      pr.className = "particle";
      pr.style.left = (40 + Math.random()*20) + "%";
      pr.style.top = (46 + Math.random()*18) + "%";
      pr.style.animationDelay = (Math.random()*4) + "s";
      pr.style.opacity = .2 + Math.random()*.3;
      intro.appendChild(pr);
    }

    /* ---- t·∫°o 18 c√°nh hoa ---- */
    for (let i = 0; i < 18; i++) {
      const p = document.createElement("div");
      p.className = "petal";
      p.style.setProperty("--rot", `${(i / 18) * 360}deg`);
      p.style.setProperty("--delay", `${i * 0.06}s`);
      wrap.appendChild(p);
    }

    /* ---- t·∫°o spark √°nh s√°ng bay ra ---- */
    for (let i = 0; i < 60; i++) {
      const sp = document.createElement("div");
      sp.className = "spark";
      const ang = Math.random() * Math.PI * 2;
      const dist = Math.random() * 120 + 40;
      sp.style.setProperty("--tx", `${Math.cos(ang) * dist}px`);
      sp.style.setProperty("--ty", `${Math.sin(ang) * dist}px`);
      sp.style.setProperty("--d", `${0.8 + Math.random()*1.4}s`);
      wrap.appendChild(sp);
    }

    /* ---- m·ªü r√®m chuy·ªÉn c·∫£nh (b√πng s√°ng) ---- */
    setTimeout(() => {
      curtain.classList.add("go");
    }, 2600);

    /* ---- B·∫ÆT ƒê·∫¶U MAIN SCENE R·∫§T S·ªöM (khi flash v·ª´a l√≥e) ---- */
    setTimeout(() => {
      startMainScene();
    }, 2800);   // tr∆∞·ªõc l√† 3200

    /* ---- FADING intro ƒëi s·ªõm ƒë·ªÉ th·∫•y tr√°i tim ph√≠a sau ---- */
    setTimeout(() => {
      intro.classList.add("fade-out");
    }, 3000);   // tr∆∞·ªõc l√† 3600

    /* ---- remove h·∫≥n kh·ªèi DOM sau khi fade xong ---- */
    setTimeout(() => {
      intro.remove();
    }, 3900);   // tr∆∞·ªõc l√† 4600

  }



  /* KH·ªûI ƒê·ªòNG INTRO */
  createLotusIntro();


  /* ==========================
     SETUP CANVAS + PARTICLES
  ========================== */

  const dpr = Math.min(window.devicePixelRatio || 1, 2);
  const canvas = document.getElementById('fx');
  const ctx = canvas.getContext('2d');
  const vid = document.getElementById('bgvid');
  const below = document.getElementById('belowHeart');
  let W, H, CX, CY, R;

  const COARSE = window.matchMedia('(pointer:coarse)').matches;

  function resize(){
    W = canvas.width = Math.floor(window.innerWidth * dpr);
    H = canvas.height = Math.floor(window.innerHeight * dpr);
    canvas.style.width = '100%'; canvas.style.height = '100%';
    ctx.setTransform(1,0,0,1,0,0);
    ctx.scale(dpr, dpr);
    CX = W/dpr/2;
    CY = H/dpr/2;
    R = Math.min(CX, CY)*0.6;
    positionBelow();
  }
  window.addEventListener('resize', resize, {passive:true});
  // ‚ùå kh√¥ng g·ªçi resize() ngay, ƒë·ª£i startMainScene() g·ªçi


  /* ==========================
     ANIMATION TITLE POP-IN
     (ƒë∆∞a v√†o h√†m ƒë·ªÉ g·ªçi sau intro)
  ========================== */
  const headline = document.getElementById('headline');
  const raw = headline.textContent;
  headline.textContent = '';

  function initHeadline(){
    [...raw].forEach((ch, i) => {
      const span = document.createElement('span');
      span.className = 'char';
      span.textContent = ch;
      headline.appendChild(span);
      setTimeout(() => span.classList.add('show'), 40 * i + 300);
    });
  }

  /* ==========================
     HEART PATH
  ========================== */
  function heartPoint(t){
    const x = 16 * Math.sin(t)**3;
    const y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
    return {x: x/18, y: -y/18};
  }
  function samplePath(steps=400){
    const pts = [];
    for(let i=0;i<=steps;i++){
      const t = (i/steps) * Math.PI * 2;
      pts.push(heartPoint(t));
    }
    return pts;
  }
  const basePath = samplePath(800);
  // ƒê·ªëm s√°ng ch·∫°y quanh ƒë∆∞·ªùng tr√°i tim
  const orbiters = [];
  function initOrbiters(){
    orbiters.length = 0;
    const COUNT = 12;
    for(let i=0;i<COUNT;i++){
      orbiters.push({
        t: Math.random()*basePath.length,    // v·ªã tr√≠ tr√™n path
        speed: 0.012 + Math.random()*0.02,   // t·ªëc ƒë·ªô tr√¥i
        size: 3 + Math.random()*3
      });
    }
  }

  // Tia s√°ng b·∫Øn ra m·ªói nh·ªãp tim
  const rays = [];

  /* ==========================
     PARTICLES
  ========================== */
  const particles = [];
  const ripples = [];

  function spawnParticle(x, y, speed=1){
    const a = Math.atan2(y-CY, x-CX) + (Math.random()-0.5)*0.7;
    const v = (Math.random()*0.8 + 0.4) * speed;
    particles.push({
      x, y,
      vx: Math.cos(a)*v,
      vy: Math.sin(a)*v,
      life: 0,
      max: 60 + Math.random()*60,
      size: 1 + Math.random()*2,
      hue: 320 + Math.random()*30,
      sat: 80 + Math.random()*20,
      light: 55 + Math.random()*10
    });
  }

  function spawnBurst(x, y, n=120, sp=1){
    for(let i=0;i<n;i++) spawnParticle(x, y, sp);
  }

  /* ==========================
     HEART BEAT
  ========================== */
  let t0 = performance.now();
  let dashOffset = 0;
  let beatTimer = 0;
  const beatInterval = 1050;

  function onBeat(){
    // g·ª£n s√≥ng
    ripples.push({r: R*0.4, a: 1});

    // ph√°o hoa quanh ƒë∆∞·ªùng tim
    for(let i=0;i<80;i++){
      const p = basePath[(Math.random()*basePath.length)|0];
      const x = CX + p.x * R;
      const y = CY + p.y * R;
      spawnParticle(x,y, 1.6);
    }

    // tia s√°ng radial
    const RAY_COUNT = 10;
    for(let i=0;i<RAY_COUNT;i++){
      const ang = (Math.PI*2/RAY_COUNT)*i + Math.random()*0.5;
      rays.push({
        ang,
        len: R*0.4,
        alpha: 1
      });
    }
  }


  function positionBelow(){
    const margin = 28;
    let top = CY + R + margin;
    const bottomLimit = window.innerHeight - 24;
    if(top > bottomLimit) top = bottomLimit;
    below.style.position = 'fixed';
    below.style.left = '50%';
    below.style.transform = 'translateX(-50%)';
    below.style.top = `${top}px`;
  }

  /* ==========================
     RENDER LOOP
  ========================== */
  const STAR_COUNT = COARSE ? 140 : 220;
  const stars = Array.from({length: STAR_COUNT}, () => ({
    x: Math.random()*window.innerWidth,
    y: Math.random()*window.innerHeight,
    r: Math.random()*1.1 + 0.3,
    tw: Math.random()*360
  }));

  function starfield(){
    for(const s of stars){
      s.tw += 0.8;
      const a = (Math.sin(s.tw*Math.PI/180)*0.5 + 0.5) * 0.7 + 0.1;
      ctx.beginPath();
      ctx.fillStyle = `rgba(255,255,255,${a})`;
      ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
      ctx.fill();
    }
  }

  function render(now){
    const dt = Math.max(16, now - t0);
    t0 = now;

    beatTimer += dt;
    if(beatTimer > beatInterval){
      beatTimer -= beatInterval;
      onBeat();
    }

    ctx.clearRect(0,0,canvas.width/dpr, canvas.height/dpr);

    starfield();

    const beat = 0.9 + 0.06*Math.sin((now/beatInterval)*Math.PI*2);

    ctx.save();
    ctx.translate(CX, CY);
    ctx.scale(beat, beat);

    ctx.lineWidth = 3;
    ctx.strokeStyle = '#ff7abc';
    ctx.shadowColor = 'rgba(255,136,209,0.9)';
    ctx.shadowBlur = 24;
    ctx.beginPath();
    for(let i=0;i<basePath.length;i++){
      const p = basePath[i];
      const x = p.x * R, y = p.y * R;
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    ctx.closePath();

    const dashLen = 120, gap = 14;
    dashOffset = (dashOffset + dt*0.08) % (dashLen+gap);
    ctx.setLineDash([dashLen, gap]);
    ctx.lineDashOffset = -dashOffset;

    // stroke tr√°i tim
    ctx.stroke();

    // fill nh·∫π b√™n trong tim
    const g = ctx.createRadialGradient(0,0, R*0.1, 0,0, R*0.9);
    g.addColorStop(0, 'rgba(255,166,222,0.35)');
    g.addColorStop(1, 'rgba(255,110,190,0.02)');
    ctx.fillStyle = g;
    ctx.fill();

    /* V·∫ßng s√°ng ƒë·∫≠p theo nh·ªãp tim */
    const glowPulse = 0.35 + 0.25*Math.sin((now/beatInterval)*Math.PI*2);
    ctx.save();
    ctx.globalCompositeOperation = 'lighter';
    const g2 = ctx.createRadialGradient(0,0,R*0.2, 0,0,R*1.25);
    g2.addColorStop(0, `rgba(255,190,245,${glowPulse})`);
    g2.addColorStop(1, 'rgba(255,130,220,0)');
    ctx.fillStyle = g2;
    ctx.fillRect(-R*1.3, -R*1.3, R*2.6, R*2.6);
    ctx.restore();

    /* Orbiters ‚Äì ƒë·ªëm s√°ng ch·∫°y quanh vi·ªÅn tim */
    for(const o of orbiters){
      o.t += o.speed * dt * 0.06;
      if(o.t >= basePath.length) o.t -= basePath.length;

      const idx = Math.floor(o.t) % basePath.length;
      const p = basePath[idx];
      const ox = p.x * (R*0.98);
      const oy = p.y * (R*0.98);

      const pulse = 0.7 + 0.3*Math.sin(now*0.008 + o.t*0.02);
      const s = o.size * pulse;

      ctx.beginPath();
      ctx.fillStyle = `rgba(255,230,255,${0.7*pulse})`;
      ctx.arc(ox, oy, s/2, 0, Math.PI*2);
      ctx.fill();
    }

    ctx.restore();


    /* RIPPLES */
    for(let i=ripples.length-1; i>=0; i--){
      const rp = ripples[i];
      rp.r += dt*0.12;
      rp.a *= 0.985;
      if(rp.a < 0.02){
        ripples.splice(i,1);
        continue;
      }
      ctx.beginPath();
      ctx.arc(CX, CY, rp.r, 0, Math.PI*2);
      ctx.strokeStyle = `rgba(255, 150, 220, ${rp.a*0.4})`;
      ctx.lineWidth = 2;
      ctx.stroke();
    }

    /* TIA S√ÅNG t·ª´ tim */
    for(let i=rays.length-1; i>=0; i--){
      const r = rays[i];
      r.len += dt*0.25;
      r.alpha *= 0.96;
      if(r.alpha < 0.02){
        rays.splice(i,1);
        continue;
      }

      ctx.save();
      ctx.translate(CX, CY);
      ctx.rotate(r.ang);
      const grad = ctx.createLinearGradient(0,0, r.len,0);
      grad.addColorStop(0, `rgba(255,200,250,${r.alpha})`);
      grad.addColorStop(1, 'rgba(255,200,250,0)');
      ctx.strokeStyle = grad;
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(R*0.2, 0);
      ctx.lineTo(R*0.2 + r.len, 0);
      ctx.stroke();
      ctx.restore();
    }


    requestAnimationFrame(render);
  }

  /* ==========================
     INTERACTION
  ========================== */
  let lastX = null, lastY = null, lastTime = 0;

  window.addEventListener('pointermove', e => {
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX - rect.left);
    const y = (e.clientY - rect.top);

    const now = performance.now();
    const dt = now - lastTime;

    const dx = lastX==null ? 0 : x - lastX;
    const dy = lastY==null ? 0 : y - lastY;
    const dist = Math.hypot(dx, dy);

    if(dt > 14){
      const base = COARSE ? 2 : 4;
      const mult = COARSE ? 0.25 : 0.4;
      const maxN = COARSE ? 40 : 60;
      const n = Math.min(maxN, base + Math.floor(dist*mult));
      const sp = 0.9 + Math.min(1.2, dist*0.02);
      spawnBurst(x, y, n, sp);

      lastTime = now;
      lastX = x;
      lastY = y;
    }
  }, {passive:true});


  /* ==========================
     VIDEO BACKGROUND
  ========================== */

  function tryPlayVideo(){ if(vid.src) vid.play().catch(()=>{}); }

  document.addEventListener('paste', (e)=>{
    const item = [...e.clipboardData.items].find(i=> i.kind==='file' && i.type.startsWith('video/'));
    if(item){
      const file = item.getAsFile();
      setVideo(URL.createObjectURL(file));
    }
  });

  window.addEventListener('dragover', e=>{ e.preventDefault(); });
  window.addEventListener('drop', (e)=>{
    e.preventDefault();
    const file = [...e.dataTransfer.files][0];
    if(file && file.type.startsWith('video/'))
      setVideo(URL.createObjectURL(file));
  });

  fetch('1111.mp4', {method:'HEAD'})
    .then(r=>{ if(r.ok){ setVideo('1111.mp4'); }})
    .catch(()=>{});

  function setVideo(src){
    vid.src = src;
    document.body.classList.add('showVideo');
    tryPlayVideo();
  }

  /* ==========================
     FALLING TEXT SYSTEM
  ========================== */

  const lines = [
    "Ch√∫c c√¥ m·ªôt ng√†y 20/11 th·∫≠t √Ω nghƒ©a v√† tr√†n ng·∫≠p ni·ªÅm vui.",
    "K√≠nh ch√∫c c√¥ lu√¥n b√¨nh an, ni·ªÅm vui v√† may m·∫Øn tr√†n ng·∫≠p m·ªói ng√†y.",
    "Ch√∫c c√¥ lu√¥n vui v·∫ª v√† h·∫°nh ph√∫c",
    "K√≠nh ch√∫c c√¥ lu√¥n gi·ªØ v·ªØng ng·ªçn l·ª≠a nhi·ªát huy·∫øt.",
    "Ch√∫c c√¥ m·ªôt ng√†y 20/11 th·∫≠t r·ª±c r·ª° ‚ú®",
  ];
  const belowMessages = [
    "T·∫≠p th·ªÉ l·ªõp 9/10 ch√∫c c√¥ 20/11 vui v·∫ª ‚ù§Ô∏è",
    "Ch√∫c c√¥ lu√¥n vui kh·ªèe, m√£i l√† ng·ªçn ƒë√®n soi s√°ng tri th·ª©c cho h·ªçc tr√≤.",
    "Ch√∫c c√¥ lu√¥n kh·ªèe m·∫°nh, b√¨nh an v√† h·∫°nh ph√∫c üå∏",
    "M·ªói ng√†y ƒë·∫øn l·ªõp c√πng c√¥ l√† m·ªôt k·ª∑ ni·ªám üíñ"
  ];

  const rain = document.getElementById("rainContainer");
  let belowIndex = 0;

  function cycleBelowText(){
    if(!below) return;

    // ·∫©n nh·∫π r·ªìi ƒë·ªïi ch·ªØ
    below.classList.remove('show');

    setTimeout(() => {
      below.textContent = belowMessages[belowIndex];
      belowIndex = (belowIndex + 1) % belowMessages.length;
      below.classList.add('show');
    }, 260);

    // l·∫∑p sau 4.2s
    setTimeout(cycleBelowText, 4200);
  }

  function spawnFallingText() {
    const div = document.createElement("div");
    div.className = "fallingText";
    div.textContent = lines[Math.floor(Math.random() * lines.length)];

    // Cho v√†o DOM tr∆∞·ªõc ƒë·ªÉ ƒëo width
    rain.appendChild(div);

    const viewportW = window.innerWidth;
    const textW = div.offsetWidth;

    // Ch·ª´a m·ªói b√™n ~8px, t√≠nh bi√™n ƒë·ªô l·ªách t·ªëi ƒëa
    const maxOffset = Math.max(0, (viewportW - textW) / 2 - 8);
    const offset = (Math.random() * 2 - 1) * maxOffset; // [-maxOffset, maxOffset]

    // ƒê·∫∑t offset theo px
    div.style.setProperty("--x", offset + "px");

    const duration = Math.random() * 3 + 4;
    div.style.animationDuration = duration + "s";

    setTimeout(() => div.remove(), duration * 1000);
    setTimeout(spawnFallingText, 500 + Math.random() * 800);
  }



})();
</script>

</body>
</html>
